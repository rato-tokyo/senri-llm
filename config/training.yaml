# Senri 2-Stage Training Configuration

# Dataset settings
dataset:
  name: "pg19"
  config: null
  max_length: 2048
  max_train_samples: 1000
  max_val_samples: 100

# 2-Stage Training Configuration
#
# Stage 1: Memory-only - メモリレイヤーのみ学習（他はフリーズ）
# Stage 2: Full fine-tuning - 全体を低学習率で調整

two_stage:
  # Stage 1: Memory-only Fine-tuning
  stage1:
    enabled: true
    num_epochs: 2
    batch_size: 1
    gradient_accumulation_steps: 8
    learning_rate: 5.0e-5  # Medium LR
    warmup_ratio: 0.1
    niah_ratio: 0.0
    max_train_samples: 1000
    max_val_samples: 100

  # Stage 2: Full Fine-tuning
  stage2:
    enabled: true
    num_epochs: 1
    batch_size: 1
    gradient_accumulation_steps: 8
    learning_rate: 1.0e-5  # Lower LR for fine adjustment
    warmup_ratio: 0.05
    niah_ratio: 0.0
    max_train_samples: 1000
    max_val_samples: 100

# Memory optimization
optimization:
  gradient_checkpointing: true
  fp16: true
  max_grad_norm: 1.0

# Misc
misc:
  seed: 42
  dataloader_num_workers: 2
